<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>User Dashboard - Planora</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/dashboard.css">
  <link rel="icon" type="image/png" href="/icon/Planora-logo-removebg-preview.png">
</head>

<body>
  <!-- Navbar -->
  <div id="planora-navbar"></div>

  <script src="/js/auth.js"></script>`n
  <script src="/js/navbar.js"></script>

  <div class="dashboard-container">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <h4>Dashboard</h4>
        <p id="userName" class="mb-0"></p>
      </div>

      <nav class="sidebar-nav">
        <a href="/pages/user/dashboard.html" class="nav-item active">
          <i class="fas fa-home"></i> Overview
        </a>
        <a href="/pages/tools/ai-design-generator.html" class="nav-item">
          <i class="fas fa-paint-brush"></i> AI Design Generator
        </a>
        <a href="/pages/tools/vastu-calculator.html" class="nav-item">
          <i class="fas fa-compass"></i> Vastu Calculator
        </a>
        <a href="/pages/tools/cost-calculator.html" class="nav-item">
          <i class="fas fa-calculator"></i> Cost Estimator
        </a>
        <a href="/pages/tools/smart-requirements.html" class="nav-item">
          <i class="fas fa-list-check"></i> Smart Requirements
        </a>
        <a href="/pages/professional/browse.html" class="nav-item">
          <i class="fas fa-search"></i> Find Professionals
        </a>
        <a href="/pages/projects/gallery.html" class="nav-item">
          <i class="fas fa-building"></i> Browse Projects
        </a>

        <a href="/pages/projects/3d-preview.html" class="nav-item">
          <i class="fas fa-cube"></i> 3D Visualization
        </a>
        <a href="#" onclick="logout()" class="nav-item text-danger">
          <i class="fas fa-sign-out-alt"></i> Logout
        </a>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <div class="content-header">
        <h1>Welcome Back!</h1>
        <p class="text-muted">Manage your projects and explore our platform features</p>
      </div>

      <!-- Stats Cards -->
      <div class="row g-4 mb-4">
        <div class="col-md-3">
          <div class="stat-card">
            <div class="stat-icon bg-primary">
              <i class="fas fa-project-diagram"></i>
            </div>
            <div class="stat-info">
              <h3 id="projectCount">0</h3>
              <p>My Projects</p>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="stat-card">
            <div class="stat-icon bg-success">
              <i class="fas fa-calculator"></i>
            </div>
            <div class="stat-info">
              <h3 id="estimateCount">0</h3>
              <p>Cost Estimates</p>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="stat-card">
            <div class="stat-icon bg-warning">
              <i class="fas fa-calendar"></i>
            </div>
            <div class="stat-info">
              <h3 id="bookingCount">0</h3>
              <p>Bookings</p>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="stat-card">
            <div class="stat-icon bg-info">
              <i class="fas fa-heart"></i>
            </div>
            <div class="stat-info">
              <h3 id="savedCount">0</h3>
              <p>Saved Items</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Feature Cards -->
      <h4 class="mb-3">Quick Actions</h4>
      <div class="row g-4">
        <div class="col-md-4">
          <div class="feature-card">
            <div class="feature-icon">
              <i class="fas fa-magic"></i>
            </div>
            <h5>AI Design Generator</h5>
            <p>Generate personalized interior designs with AI</p>
            <a href="/pages/tools/ai-design-generator.html" class="btn btn-primary btn-sm">Start Designing</a>
          </div>
        </div>

        <div class="col-md-4">
          <div class="feature-card">
            <div class="feature-icon">
              <i class="fas fa-rupee-sign"></i>
            </div>
            <h5>Cost Calculator</h5>
            <p>Get instant estimates for your construction project</p>
            <a href="/pages/tools/cost-calculator.html" class="btn btn-primary btn-sm">Calculate Now</a>
          </div>
        </div>

        <div class="col-md-4">
          <div class="feature-card">
            <div class="feature-icon">
              <i class="fas fa-compass"></i>
            </div>
            <h5>Vastu Guidance</h5>
            <p>Check Vastu compliance for your property</p>
            <a href="/pages/tools/vastu-calculator.html" class="btn btn-primary btn-sm">Check Vastu</a>
          </div>
        </div>

        <div class="col-md-4">
          <div class="feature-card">
            <div class="feature-icon">
              <i class="fas fa-users"></i>
            </div>
            <h5>Find Professionals</h5>
            <p>Search and connect with verified architects & designers</p>
            <a href="/pages/professional/browse.html" class="btn btn-primary btn-sm">Browse Pros</a>
          </div>
        </div>

        <div class="col-md-4">
          <div class="feature-card">
            <div class="feature-icon">
              <i class="fas fa-clipboard-list"></i>
            </div>
            <h5>Smart Requirements</h5>
            <p>Define your project needs with our guided form</p>
            <a href="/pages/tools/smart-requirements.html" class="btn btn-primary btn-sm">Start Form</a>
          </div>
        </div>

        <div class="col-md-4">
          <div class="feature-card">
            <div class="feature-icon">
              <i class="fas fa-cube"></i>
            </div>
            <h5>3D Visualization</h5>
            <p>View and explore 3D models of your designs</p>
            <a href="/pages/projects/3d-preview.html" class="btn btn-primary btn-sm">View Models</a>
          </div>
        </div>
      </div>

      <!-- Recent Activity -->
      <div class="mt-5">
        <h4 class="mb-3">Recent Activity</h4>
        <div class="activity-list" id="activityList">
          <p class="text-muted">No recent activity</p>
        </div>
      </div>
    </main>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    // Require authentication
    if (!requireAuth()) {
      // Will redirect to login
    } else {
      const userData = getUserData();
      document.getElementById('userName').textContent = userData.name;

      // Load dashboard data
      loadDashboardData();
    }

    async function loadDashboardData() {
      try {
        const headers = getAuthHeader();

        // 1. Fetch Bookings
        const bookingsRes = await fetch('/api/bookings/user', { headers });
        if (bookingsRes.ok) {
          const bookings = await bookingsRes.json();
          document.getElementById('bookingCount').textContent = bookings.length;
        }

        // 2. Fetch Cost Estimates
        const estimatesRes = await fetch('/api/cost-estimates', { headers });
        if (estimatesRes.ok) {
          const estimates = await estimatesRes.json();
          document.getElementById('estimateCount').textContent = estimates.length;
        }

        // 3. Fetch My Projects (assuming we filter client side or have an endpoint)
        // For now, let's try fetching all projects and filtering by user_id if API sends all
        // OR better: Create a specific endpoint for my projects if needed.
        // Let's assume GET /api/projects returns all public, so might need filter.
        // But for now, let's just initialize to 0 or leave as is if no endpoint.

        // Bonus: Fetch Saved Items if we have that feature.

      } catch (error) {
        console.error('Error loading dashboard data:', error);
      }
    }
  </script>

  <!-- Dynamic Footer Container -->
  <div id="planora-footer"></div>
  <script src="/js/footer.js"></script>

</body>

</html>
