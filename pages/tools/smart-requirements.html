<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Auth Protection -->
    <script src="/js/auth.js"></script>
    <script src="/js/navbar.js"></script>

    <script>
        // Redirect to login if not authenticated
        if (!isAuthenticated()) {
            sessionStorage.setItem('redirectAfterLogin', window.location.pathname.split('/').pop());
            window.location.href = '/pages/public/login.html';
        }
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Requirements - Planora</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/dashboard.css">
    <link rel="icon" type="image/png" href="icon/Planora-logo-removebg-preview.png">
</head>

<body>

    <!-- Navbar -->
    <div id="planora-navbar"></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/js/auth.js"></script>
    <script src="/js/navbar.js"></script>

    <!-- Hero Header Section -->
    <header style="
    background: linear-gradient(135deg, #181952, #190f39);
    padding: 40px 20px;
    text-align: center;
    color: white;
    border-bottom: 4px solid #8ed1fa;
    position: relative;
    overflow: hidden;
  ">
        <!-- Subtle floating glowing circles -->
        <div style="
      position:absolute;
      width:150px;
      height:150px;
      background:rgba(255,180,0,0.15);
      border-radius:50%;
      top:-40px;
      left:-40px;
      filter:blur(30px);
      animation: float1 6s infinite alternate ease-in-out;
    "></div>

        <div style="
      position:absolute;
      width:180px;
      height:180px;
      background:rgba(142,209,250,0.12);
      border-radius:50%;
      bottom:-50px;
      right:-50px;
      filter:blur(30px);
      animation: float2 7s infinite alternate ease-in-out;
    "></div>

        <h1 style="
      font-size: 2.5rem;
      font-weight: 900;
      letter-spacing: 2px;
      margin: 0 0 15px;
      text-shadow: 2px 2px 8px rgba(0,0,0,0.3);
      position: relative;
      z-index: 2;
    ">
            <i class="fas fa-clipboard-list me-3" style="color: #ffb703;"></i>SMART PROJECT REQUIREMENTS
        </h1>

        <p style="
      font-size: 1.1rem;
      margin: 0;
      opacity: 0.9;
      font-weight: 400;
      position: relative;
      z-index: 2;
    ">Define Your Needs → Get Expert Guidance → Create Complete Specifications</p>

        <style>
            @keyframes float1 {
                from {
                    transform: translate(0, 0) scale(1);
                }

                to {
                    transform: translate(20px, 15px) scale(1.1);
                }
            }

            @keyframes float2 {
                from {
                    transform: translate(0, 0) scale(1);
                }

                to {
                    transform: translate(-15px, -20px) scale(1.15);
                }
            }
        </style>
    </header>

    <div class="container" style="padding-top: 30px; padding-bottom: 50px;">
        <div class="row">
            <div class="col-md-10 mx-auto">


                <div class="form-wizard">
                    <!-- Progress Steps -->
                    <div class="wizard-steps">
                        <div class="wizard-step active" data-step="1">
                            <div class="step-number">1</div>
                            <p class="mb-0 small">Basics</p>
                        </div>
                        <div class="wizard-step" data-step="2">
                            <div class="step-number">2</div>
                            <p class="mb-0 small">Budget & Timeline</p>
                        </div>
                        <div class="wizard-step" data-step="3">
                            <div class="step-number">3</div>
                            <p class="mb-0 small">Style & Details</p>
                        </div>
                        <div class="wizard-step" data-step="4">
                            <div class="step-number">4</div>
                            <p class="mb-0 small">Review</p>
                        </div>
                    </div>

                    <!-- Form Steps -->
                    <form id="requirementsForm">
                        <!-- Step 1: Basics -->
                        <div class="form-step active" id="step1">
                            <h5 class="mb-4">Project Basics</h5>

                            <div class="mb-3">
                                <label class="form-label">Project Type</label>
                                <select class="form-select" id="projectType" required>
                                    <option value="">Select Type</option>
                                    <option value="New Construction">New Construction</option>
                                    <option value="Renovation">Renovation</option>
                                    <option value="Interior Design">Interior Design</option>
                                    <option value="Landscape">Landscape Design</option>
                                </select>
                            </div>

                            <div class="mb-3">
                                <label class="form-label">Approximate Area (sq ft)</label>
                                <input type="number" class="form-control" id="area" placeholder="e.g., 1500" min="100"
                                    required>
                            </div>

                            <div class="mb-3">
                                <label class="form-label">Project Location</label>
                                <input type="text" class="form-control" id="location" placeholder="Enter city or area"
                                    required>
                            </div>

                            <div class="mb-3">
                                <label class="form-label">Pin Location on Map (Optional)</label>
                                <div id="map" class="map-container"></div>
                                <input type="hidden" id="latitude">
                                <input type="hidden" id="longitude">
                            </div>

                            <div class="d-flex justify-content-end">
                                <button type="button" class="btn btn-primary" onclick="nextStep(2)">Next <i
                                        class="fas fa-arrow-right ms-1"></i></button>
                            </div>
                        </div>

                        <!-- Step 2: Budget & Timeline -->
                        <div class="form-step" id="step2" style="display:none;">
                            <h5 class="mb-4">Budget & Timeline</h5>

                            <div class="mb-3">
                                <label class="form-label">Budget Range</label>
                                <div class="row">
                                    <div class="col-md-6">
                                        <input type="number" class="form-control" id="budgetMin" placeholder="Min (₹)"
                                            min="0">
                                    </div>
                                    <div class="col-md-6">
                                        <input type="number" class="form-control" id="budgetMax" placeholder="Max (₹)"
                                            min="0">
                                    </div>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label class="form-label">Preferred Timeline</label>
                                <select class="form-select" id="timeline">
                                    <option value="">Select Timeline</option>
                                    <option value="1-3 months">1-3 months</option>
                                    <option value="3-6 months">3-6 months</option>
                                    <option value="6-12 months">6-12 months</option>
                                    <option value="1+ year">More than 1 year</option>
                                    <option value="Flexible">Flexible</option>
                                </select>
                            </div>

                            <div class="d-flex justify-content-between">
                                <button type="button" class="btn btn-outline-secondary" onclick="prevStep(1)"><i
                                        class="fas fa-arrow-left me-1"></i> Previous</button>
                                <button type="button" class="btn btn-primary" onclick="nextStep(3)">Next <i
                                        class="fas fa-arrow-right ms-1"></i></button>
                            </div>
                        </div>

                        <!-- Step 3: Style & Details -->
                        <div class="form-step" id="step3" style="display:none;">
                            <h5 class="mb-4">Style Preferences & Specific Requirements</h5>

                            <div class="mb-3">
                                <label class="form-label">Preferred Design Style</label>
                                <select class="form-select" id="stylePreference">
                                    <option value="">Select Style</option>
                                    <option value="Modern">Modern</option>
                                    <option value="Contemporary">Contemporary</option>
                                    <option value="Traditional">Traditional</option>
                                    <option value="Minimalist">Minimalist</option>
                                    <option value="Industrial">Industrial</option>
                                    <option value="Scandinavian">Scandinavian</option>
                                    <option value="Luxury">Luxury</option>
                                </select>
                            </div>

                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label class="form-label">Number of Bedrooms</label>
                                    <input type="number" class="form-control" id="numBedrooms" placeholder="e.g., 3"
                                        min="0" value="3">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Number of Bathrooms</label>
                                    <input type="number" class="form-control" id="numBathrooms" placeholder="e.g., 2"
                                        min="0" value="2">
                                </div>
                            </div>

                            <div class="mb-3">
                                <label class="form-label">Specific Requirements or Special Needs</label>
                                <textarea class="form-control" id="specificRequirements" rows="4"
                                    placeholder="Tell us about any specific requirements, accessibility needs, sustainable features, smart home integration, etc."></textarea>
                            </div>

                            <div class="d-flex justify-content-between">
                                <button type="button" class="btn btn-outline-secondary" onclick="prevStep(2)"><i
                                        class="fas fa-arrow-left me-1"></i> Previous</button>
                                <button type="button" class="btn btn-primary" onclick="nextStep(4)">Review <i
                                        class="fas fa-arrow-right ms-1"></i></button>
                            </div>
                        </div>

                        <!-- Step 4: Review & Submit -->
                        <div class="form-step" id="step4" style="display:none;">
                            <h5 class="mb-4">Review Your Requirements</h5>

                            <div id="reviewSummary" class="alert alert-light">
                                <!-- Will be populated -->
                            </div>

                            <div class="form-check mb-3">
                                <input class="form-check-input" type="checkbox" id="agreeTerms" required>
                                <label class="form-check-label" for="agreeTerms">
                                    I agree to share these requirements with verified professionals on Planora
                                </label>
                            </div>

                            <div class="d-flex justify-content-between">
                                <button type="button" class="btn btn-outline-secondary" onclick="prevStep(3)"><i
                                        class="fas fa-arrow-left me-1"></i> Previous</button>
                                <button type="submit" class="btn btn-success btn-lg">
                                    <i class="fas fa-paper-plane me-2"></i>Submit Requirements
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
        if (!requireAuth()) {
            // Will redirect
        }

        let map;
        let marker;

        // Initialize map
        function initMap() {
            map = L.map('map').setView([20.5937, 78.9629], 5); // India center

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 19,
                attribution: '© OpenStreetMap contributors'
            }).addTo(map);

            map.on('click', function (e) {
                if (marker) {
                    map.removeLayer(marker);
                }
                marker = L.marker(e.latlng).addTo(map);
                document.getElementById('latitude').value = e.latlng.lat;
                document.getElementById('longitude').value = e.latlng.lng;
            });
        }

        setTimeout(initMap, 500); // Initialize after page load

        function nextStep(step) {
            // Hide current step
            document.querySelectorAll('.form-step').forEach(s => s.style.display = 'none');
            document.querySelectorAll('.wizard-step').forEach(s => s.classList.remove('active'));

            // Show next step
            document.getElementById(`step${step}`).style.display = 'block';
            document.querySelector(`.wizard-step[data-step="${step}"]`).classList.add('active');

            // Mark previous as completed
            for (let i = 1; i < step; i++) {
                document.querySelector(`.wizard-step[data-step="${i}"]`).classList.add('completed');
            }

            // If review step, populate summary
            if (step === 4) {
                populateReview();
            }

            window.scrollTo(0, 0);
        }

        function prevStep(step) {
            document.querySelectorAll('.form-step').forEach(s => s.style.display = 'none');
            document.getElementById(`step${step}`).style.display = 'block';

            document.querySelectorAll('.wizard-step').forEach(s => s.classList.remove('active'));
            document.querySelector(`.wizard-step[data-step="${step}"]`).classList.add('active');
        }

        function populateReview() {
            const summary = `
        <h6>Project Details:</h6>
        <ul>
          <li><strong>Type:</strong> ${document.getElementById('projectType').value}</li>
          <li><strong>Area:</strong> ${document.getElementById('area').value} sq ft</li>
          <li><strong>Location:</strong> ${document.getElementById('location').value}</li>
        </ul>
        <h6>Budget & Timeline:</h6>
        <ul>
          <li><strong>Budget:</strong> ₹${document.getElementById('budgetMin').value || '0'} - ₹${document.getElementById('budgetMax').value || 'Open'}</li>
          <li><strong>Timeline:</strong> ${document.getElementById('timeline').value || 'Not specified'}</li>
        </ul>
        <h6>Design Preferences:</h6>
        <ul>
          <li><strong>Style:</strong> ${document.getElementById('stylePreference').value || 'Not specified'}</li>
          <li><strong>Bedrooms:</strong> ${document.getElementById('numBedrooms').value}</li>
          <li><strong>Bathrooms:</strong> ${document.getElementById('numBathrooms').value}</li>
          <li><strong>Special Requirements:</strong> ${document.getElementById('specificRequirements').value || 'None specified'}</li>
        </ul>
      `;
            document.getElementById('reviewSummary').innerHTML = summary;
        }

        document.getElementById('requirementsForm').addEventListener('submit', async function (e) {
            e.preventDefault();

            const data = {
                project_type: document.getElementById('projectType').value,
                area: document.getElementById('area').value,
                location: document.getElementById('location').value,
                latitude: document.getElementById('latitude').value,
                longitude: document.getElementById('longitude').value,
                budget_min: document.getElementById('budgetMin').value,
                budget_max: document.getElementById('budgetMax').value,
                timeline: document.getElementById('timeline').value,
                style_preference: document.getElementById('stylePreference').value,
                num_bedrooms: document.getElementById('numBedrooms').value,
                num_bathrooms: document.getElementById('numBathrooms').value,
                specific_requirements: document.getElementById('specificRequirements').value
            };

            try {
                const response = await fetch('/api/requirements', {
                    method: 'POST',
                    headers: getAuthHeader(),
                    body: JSON.stringify(data)
                });

                const result = await response.json();

                if (response.ok) {
                    const successModal = new bootstrap.Modal(document.getElementById('successModal'));
                    successModal.show();
                } else {
                    alert(result.error || 'Submission failed');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Failed to submit. Please try again.');
            }
        });
    </script>

    <!-- Success Modal -->
    <div class="modal fade" id="successModal" tabindex="-1" data-bs-backdrop="static">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content text-center p-4"
                style="background: linear-gradient(135deg, #181952, #190f39); color: white; border: 1px solid #8ed1fa; border-radius: 20px; box-shadow: 0 0 20px rgba(142, 209, 250, 0.3);">
                <div class="modal-body">
                    <div class="mb-4">
                        <div
                            style="background: rgba(0, 191, 166, 0.2); width: 80px; height: 80px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto;">
                            <i class="fas fa-check fa-3x" style="color: #00bfa6;"></i>
                        </div>
                    </div>
                    <h3 class="mb-3" style="font-weight: 700; letter-spacing: 1px;">Submission Successful!</h3>
                    <p class="mb-4" style="font-size: 1.1rem; opacity: 0.9; line-height: 1.6;">
                        "Requirements submitted successfully! <br> Our professionals will contact you soon."
                    </p>
                    <button type="button" class="btn btn-lg w-100"
                        onclick="window.location.href='/pages/professional/browse.html'"
                        style="background: #ffb703; color: #141032; font-weight: 700; border-radius: 30px; padding: 12px; transition: transform 0.2s;">
                        Continue Browsing
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Dynamic Footer Container -->
    <div id="planora-footer"></div>
    <script src="/js/footer.js"></script>

</body>

</html>